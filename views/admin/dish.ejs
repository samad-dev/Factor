<%- contentFor('HeaderCss') %>
<!-- Daterangepicker css -->
<link rel="stylesheet" href="assets/vendor/daterangepicker/daterangepicker.css">

<!-- Vector Map css -->
<link rel="stylesheet" href="assets/vendor/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10"></link>
<link href="assets/vendor/datatables.net-bs5/css/dataTables.bootstrap5.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/datatables.net-select-bs5/css/select.bootstrap5.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/quill/quill.core.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/quill/quill.snow.css" rel="stylesheet" type="text/css" />
<link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet" type="text/css" />

<%- contentFor('body') %>

<!-- end row -->


<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h1 class="header-title" class="mb-6" style="font-size: 20px;">Dishes</h1>
                <br>
                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#top-modal" onclick="clearModalFields()">Add</button>
                <button class="btn btn-primary mt-2 mt-md-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">Toggle right offcanvas</button>
                <br>
                <br>


                <table id="basic-datatable" class="table table-striped dt-responsive wrap w-100">
                    <thead>
                        <tr>
                            <th>S NO#</th>
                            <th>Name</th>
                            <th>Calories</th>                          
                            <th>Allergens</th>
                            <th>Add On</th>
                            <th>Label</th>
                            <th>Instruction</th>
                            <th>Description</th>    
                            <th>Created At</th>
                            <th>Updated At</th>
                            <th>Edit</th>
                           
                        </tr>
                    </thead>         
                
                    <tbody>

                        
                    </tbody>
                </table> 

            </div> <!-- end card body-->
        </div> <!-- end card -->
    </div><!-- end col-->
</div> <!-- end row-->
<div class="offcanvas offcanvas-end" style="width: 40%;" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel">Add Dish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div> <!-- end offcanvas-header-->

    <div class="offcanvas-body">
        <div class="row">
            <div class="col-6 pb-3">   
                
                <label for="" style="font-size: 16px;" >Name</label>
                  <input type="text" class="form-control" id="Name">
                   
            </div>
            <div class="col-6 pb-3">
                <label for="" style="font-size: 16px;"   >Calories</label>
                    <input type="text" class="form-control" id="calories">
                 
            </div>
            <div class="col-6 pb-3">   
                
                <label for="" style="font-size: 16px;" >Allergens</label>
                <input type="text" class="form-control" id="allergens">
                   
            </div>
            <div class="col-6 pb-3">
                <label for="" style="font-size: 16px;" >Add On</label>
                <input type="text" class="form-control" id="addon">  
            </div>
            <div class="col-6 pb-3">   
                
                <label for="" style="font-size: 16px;" >Label</label>
               <input type="text" class="form-control" id="label">
                   
            </div>
            <div class="col-6 pb-3">   
                
                <label for="" style="font-size: 16px;" >Label</label>
                <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ...">
                    <option value="AK">Alaska</option>
                                <option value="HI">Hawaii</option>
                </select>
                   
            </div>
            <div class="col-5 pb-3 pt-3">
                <label for="">Ingredient</label>
                <input type="text" class="form-control">
             </div>
            <div class="col-5 pb-3 pt-3">
                <label for="">Quantity</label>
                <input type="number" class="form-control">

            </div>
            <div class="col-2 pb-3 pt-4">
                <button type="button" class="btn btn-soft-primary" id="addField">Add</button>
            </div>
          
                <div id="ingredientForm">
                    <div id="ingredientFields">
                
                    </div>       
                </div>

            <div class="col-12">   
                
                <label for="" style="font-size: 16px;" >Instruction</label>
         
                <div id="bubble-editor" style="height: 100px;">
                </div>
                   
            </div>
          

                   
               <label for="">Description</label>
               <div id="snow-editor" style="height: 300px;">
                
                </div>
               <input type="hidden" id="hidden"></input>
               <br>
            </div>
        </div>
    </div> <!-- end offcanvas-body-->
</div> <!-- end offcanvas-->


<div id="top-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="padding:10px 20px;" >
            <div class="modal-header">
                <h4 class="modal-title" id="topModalLabel">Add Dish</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <br>
               <label for="" style="font-size: 16px;" >Name</label>
               <input type="text" class="form-control" id="Name">
               <br>
               <label for="" style="font-size: 16px;"   >Calories/label>
               <input type="text" class="form-control" id="calories">
               <br>
               <label for="" style="font-size: 16px;" >Allergens</label>
               <input type="text" class="form-control" id="allergens">
               <br>
               <label for="" style="font-size: 16px;" >Add On</label>
               <input type="text" class="form-control" id="addon">
               <br>
               <label for="" style="font-size: 16px;" >Label</label>
               <input type="text" class="form-control" id="label">
               <br>
               <label for="">Description</label>
               <div id="snow-editor" style="height: 300px;">
                <h3><span class="ql-size-large">Hello World!</span></h3>
                <p><br></p>
                <h3>This is an simple editable area.</h3>
                <p><br></p>
                <ul>
                    <li>
                        Select a text to reveal the toolbar.
                    </li>
                    <li>
                        Edit rich document on-the-fly, so elastic!
                    </li>
                </ul>
                <p><br></p>
                <p>
                    End of simple area
                </p>
            </div>
               <input type="hidden" id="hidden"></input>
               <br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submit()">Save changes</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div



<%- contentFor('FooterJs') %>

<!-- Vector Map js -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script src="assets/vendor/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="assets/vendor/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
<script src="assets/vendor/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="assets/vendor/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>
<script src="assets/vendor/datatables.net-fixedcolumns-bs5/js/fixedColumns.bootstrap5.min.js"></script>
<script src="assets/vendor/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="assets/vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="assets/vendor/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js"></script>
<script src="assets/vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="assets/vendor/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="assets/vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="assets/vendor/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="assets/vendor/datatables.net-select/js/dataTables.select.min.js"></script>
<script src="assets/vendor/select2/js/select2.min.js"></script>
<script src="assets/vendor/quill/quill.min.js"></script>

<!-- Quill Demo js -->
<script src="assets/js/pages/demo.quilljs.js"></script>

<script>



$('document').ready(function(){
  // Destroy existing DataTable instance (if it exists)
if ($.fn.DataTable.isDataTable('#basic-datatable')) {
    $('#basic-datatable').DataTable().destroy();
}

$("#basic-datatable").DataTable({
    // scrollX:!0,
    keys: true,
    language: {
        paginate: {
            previous: "<i class='ri-arrow-left-s-line'>",
            next: "<i class='ri-arrow-right-s-line'>"
        }
    },
    drawCallback: function () {
        $(".dataTables_paginate > .pagination").addClass("pagination-rounded");
    }
});
  fetch();

})
function submit(){

var update_id = $('#hidden').val();
if(update_id == ""){
var form = new FormData();
    form.append("nutrient", document.getElementById("nutrient").value);
    form.append("nutrient_unit", document.getElementById("nutrient_unit").value);
   

    var settings = {
        "url": "/nutrient",
        "method": "POST",
        "timeout": 0,
        "processData": false,
        "mimeType": "multipart/form-data",
        "contentType": false,
        "data": form
    };

    $.ajax({
        ...settings,
        statusCode: {
            200: function(response) {
                console.log(response);
                console.log("Request was successful");
                $('#top-modal').modal('hide');
               
                fetch()
                Swal.fire(
                    'Success!',
                    'Nutrient Created Successfully',
                    'success'
                )
            },
        },
        success: function(data) {
            // $('#myModal').reset();
            // Additional success handling if needed
        },
        error: function(xhr, textStatus, errorThrown) {
            console.log(xhr)
            Swal.fire(
                'Server Error!',
                'Nutrient Not Created',
                'error'
            )
        }
    });
}
else{
    var form = new FormData();
    form.append("nutrient", document.getElementById("nutrient").value);
    form.append("nutrient_unit", document.getElementById("nutrient_unit").value);
   


    var settings = {
        "url": "/nutrient/" + update_id, // Fixed the URL concatenation
        "method": "PUT",
        "timeout": 0,
        "processData": false,
        "mimeType": "multipart/form-data",
        "contentType": false,
        "data": form
    };

    $.ajax({
        ...settings,
        success: function (data) {
            console.log(data);
            console.log("Request was successful");
            $('#top-modal').modal('hide');
               
               fetch()

            Swal.fire(
                'Success!',
                'Nutrient Updated Successfully',
                'success'
            );
        },
        error: function (xhr, textStatus, errorThrown) {
            console.log(xhr);
            Swal.fire(
                'Server Error!',
                'Nutrient Not Updated',
                'error'
            );
        }
    });
        }

}

function edit(id){
    clearModalFields();
    var settings = {
    "url": "/nutrient/"+id,
    "method": "GET",
    "timeout": 0,
};
$.ajax(settings).done(function(response) {
    
    $('#nutrient').val(response['nutrient']);
    $('#nutrient_unit').val(response['nutrient_unit']);

})

    $('#top-modal').modal('show');
    $('#hidden').val(id);

}
function fetch(){
var settings = {
    "url": "/dish",
    "method": "GET",
    "timeout": 0,
};
let table = new DataTable('#basic-datatable');

$.ajax(settings).done(function(response) {
    console.log(response);
    table.clear().draw();
    $.each(response, function(index, data) {
        table.row.add([
            index + 1,
            data.dish_name,
            data.total_calories,
            data.allergens,
            data.add_on,
            data.label,
            data.instructions,
            data.description,
            data.created_at,
            data.updated_at,
            '<button type="button"id="edit" name="edit" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"  onclick="edit(' +
            data.id +
            ')"  class="btn btn-soft-secondary "style="padding:5px 10px;" ><i class="ri ri-pencil-fill font-size-16 align-middle" style="font-size:16px;"></i></button>',
            ]).draw(false);
    });
});
}
function clearModalFields() {
    // Select all input, textarea, and select elements within the modal
    $('#top-modal :input').each(function() {
        var elementType = this.type;
        var elementId = this.id;

        // Handle different input types appropriately
        switch (elementType) {
            case 'text':
            case 'number':
            case 'file':
            case 'hidden':
            case 'textarea':
            case 'select':
                $('#' + elementId).val('');
                break;

            // Add more cases as needed for other input types
        }
    });
}



$('#addField').on('click', function() {
    // Append a new set of fields and a button to the form
    $('#ingredientFields').append(`
    <div>
     <div class="row pb-3" id="ing_div">
        <div class="col-5">
            
        <input type="text" name="ingredient[]" class="form-control"></div>
<div class="col-5">  <input type="number" name="qty[]" class="form-control"></div>
<div class="col-2"><button type="button" class="btn btn-danger removeField " >Remove</button></div>
        
       
      
        </div>
 </div>
    `);
  });

  // Handle click event of the "Remove" button within a set of fields
  $('#ingredientForm').on('click', '#ing_div', function() {
    // Remove the parent div when the "Remove" button is clicked
    $(this).remove();
  });
</script>
